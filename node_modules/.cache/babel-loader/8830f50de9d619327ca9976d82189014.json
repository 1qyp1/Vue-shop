{"ast":null,"code":"import { Toast } from 'vant';\nimport http from '@/common/api/request.js';\nimport { mapState, mapGetters, mapMutations } from 'vuex';\nimport bus from '@/common/bus.js';\nimport qs from 'qs';\nexport default {\n  data() {\n    return {\n      radioPayment: 'wx',\n      path: {},\n      item: [],\n      total: {\n        price: 0,\n        num: 0\n      }\n    };\n  },\n\n  computed: { ...mapState({\n      order_id: state => state.order.order_id,\n      selectList: state => state.cart.selectList\n    }),\n    ...mapGetters(['defaultPath'])\n  },\n\n  created() {\n    this.goodsList = JSON.parse(this.$route.query.goodsList);\n    this.selectAddress();\n  },\n\n  activated() {\n    bus.$on('selectPath', function (data) {\n      this.path = JSON.parse(data);\n    }.bind(this)); //选中的商品id号\n\n    this.item = JSON.parse(this.$route.query.detail);\n    this.goodsList = JSON.parse(this.$route.query.goodsList);\n    this.selectOrder();\n  },\n\n  methods: { ...mapMutations(['initData', 'initOrder']),\n\n    //查询地址\n    selectAddress() {\n      http.$axios({\n        url: '/api/selectAddress',\n        method: \"post\",\n        headers: {\n          token: true\n        }\n      }).then(res => {\n        this.initData(res.data); //有默认收货地址\n\n        if (this.defaultPath.length) {\n          this.path = this.defaultPath[0];\n        } else {\n          this.path = res.data[0];\n        }\n      });\n    },\n\n    //查询订单\n    selectOrder() {\n      http.$axios({\n        url: '/api/selectOrder',\n        method: \"post\",\n        headers: {\n          token: true\n        },\n        data: {\n          orderId: this.order_id\n        }\n      }).then(res => {\n        this.initOrder(res.data);\n        this.total = {\n          price: res.data[0].goods_price,\n          num: res.data[0].goods_num\n        };\n      });\n    },\n\n    //选择收货地址\n    goPath() {\n      this.$router.push({\n        path: '/path',\n        query: {\n          type: 'select'\n        }\n      });\n    },\n\n    //提交订单\n    goPayment() {\n      //判断是否选择了收货地址\n      if (!this.path) return Toast('请填写收货地址'); //发送请求==》1.修改订单状态2.删除购物车的数据\n\n      http.$axios({\n        url: '/api/submitOrder',\n        method: \"post\",\n        headers: {\n          token: true\n        },\n        data: {\n          orderId: this.order_id,\n          shopArr: this.selectList\n        }\n      }).then(res => {\n        let newArr = [];\n        this.goodsList.forEach(v => {\n          newArr.push(v.goods_name);\n        }); //支付传递的参数\n\n        let dataOrder = {\n          orderId: this.order_id,\n          name: newArr.join(''),\n          price: this.total.price\n        };\n\n        if (res.success) {\n          //去支付\n          http.$axios({\n            url: '/api/payment',\n            method: \"post\",\n            headers: {\n              token: true,\n              'Content-Type': 'application/x-www-form-urlencoded'\n            },\n            //qs是增加安全性的序列化\n            data: qs.stringify(dataOrder)\n          }).then(res => {\n            if (res.success) {\n              //打开支付宝支付的页面\n              window.location.href = res.paymentUrl;\n            }\n          });\n        }\n      });\n      return;\n    }\n\n  }\n};","map":{"version":3,"mappings":"AA4DA;AACA;AACA;AACA;AACA;AACA;EACAA;IACA;MACAC,kBADA;MAEAC,QAFA;MAGAC,QAHA;MAIAC;QACAC,QADA;QAEAC;MAFA;IAJA;EASA,CAXA;;EAYAC,YACA;MACAC,uCADA;MAEAC;IAFA,EADA;IAKA;EALA,CAZA;;EAoBAC;IACA;IACA;EACA,CAvBA;;EAwBAC;IACAC;MAEA;IAEA,CAJA,CAIAC,IAJA,CAIA,IAJA,GADA,CAMA;;IACA;IACA;IACA;EACA,CAlCA;;EAmCAC,WACA,0CADA;;IAEA;IACAC;MACAC;QACAC,yBADA;QAEAC,cAFA;QAGAC;UACAC;QADA;MAHA,GAMAC,IANA,CAMAC;QACA,wBADA,CAEA;;QACA;UACA;QACA,CAFA,MAEA;UACA;QACA;MACA,CAdA;IAeA,CAnBA;;IAoBA;IACAC;MACAP;QACAC,uBADA;QAEAC,cAFA;QAGAC;UACAC;QADA,CAHA;QAMApB;UACAwB;QADA;MANA,GASAH,IATA,CASAC;QACA;QAEA;UACAjB,8BADA;UAEAC;QAFA;MAIA,CAhBA;IAiBA,CAvCA;;IAwCA;IACAmB;MACA;QACAvB,aADA;QAEAwB;UACAC;QADA;MAFA;IAMA,CAhDA;;IAiDA;IACAC;MACA;MACA,wCAFA,CAIA;;MACAZ;QACAC,uBADA;QAEAC,cAFA;QAGAC;UACAC;QADA,CAHA;QAMApB;UACAwB,sBADA;UAEAK;QAFA;MANA,GAUAR,IAVA,CAUAC;QAEA;QACA;UACAQ;QACA,CAFA,EAHA,CAOA;;QACA;UACAN,sBADA;UAEAO,qBAFA;UAGA1B;QAHA;;QAMA;UACA;UACAW;YACAC,mBADA;YAEAC,cAFA;YAGAC;cACAC,WADA;cAEA;YAFA,CAHA;YAOA;YACApB;UARA,GASAqB,IATA,CASAC;YACA;cACA;cACAU;YACA;UACA,CAdA;QAgBA;MACA,CA3CA;MA4CA;IACA;;EApGA;AAnCA","names":["data","radioPayment","path","item","total","price","num","computed","order_id","selectList","created","activated","bus","bind","methods","selectAddress","http","url","method","headers","token","then","res","selectOrder","orderId","goPath","query","type","goPayment","shopArr","newArr","name","window"],"sourceRoot":"src/views","sources":["Order.vue"],"sourcesContent":["<template>\r\n  <div class=\"order container\">\r\n    <header>\r\n      <i class=\"iconfont icon-fanhui\" @click=\"$router.back()\"></i>\r\n      <span>提交订单</span>\r\n      <i class=\"iconfont icon-kefu\"></i>\r\n    </header>\r\n    <section>\r\n      <div class=\"path\">\r\n        <h3 class=\"path-title\">收货信息</h3>\r\n        <div class=\"path-content\" @click=\"goPath\">\r\n          <div>\r\n            <span>{{ path.name }}</span>\r\n            <span>{{ path.tel }}</span>\r\n          </div>\r\n          <div>\r\n            <span>{{ path.province }}</span>\r\n            <span>{{ path.city }}</span>\r\n            <span>{{ path.county }}</span>\r\n            <span>{{ path.addressDetail }}</span>\r\n          </div>\r\n        </div>\r\n      </div>\r\n      <div class=\"payment\">\r\n        <div class=\"payment-title\">支付方式：</div>\r\n        <van-radio-group v-model=\"radioPayment\">\r\n          <van-radio name=\"wx\">微信支付</van-radio>\r\n          <van-radio name=\"ali\">支付宝支付</van-radio>\r\n        </van-radio-group>\r\n      </div>\r\n      <div class=\"goods\">\r\n        <ul>\r\n          <li v-for=\"(item, index) in goodsList\" :key=\"index\">\r\n            <div>\r\n              <img :src=\"item.goods_imgUrl\" alt=\"\" />\r\n            </div>\r\n            <div class=\"goods-content\">\r\n              <h4>{{ item.goods_name }}</h4>\r\n              <div class=\"goods-total\">\r\n                <span>¥{{ item.goods_price }}</span>\r\n                <span>x{{ item.goods_num }}</span>\r\n              </div>\r\n            </div>\r\n          </li>\r\n        </ul>\r\n      </div>\r\n    </section>\r\n    <footer>\r\n      <div class=\"order-total\">\r\n        <span>共</span>\r\n        <b>{{ total.num }}</b>\r\n        <span>件,</span>\r\n        <span>总金额：</span>\r\n        <em>¥{{ total.price }}</em>\r\n      </div>\r\n      <div class=\"order-topay\" @click=\"goPayment\">提交订单</div>\r\n    </footer>\r\n  </div>\r\n</template>\r\n<script>\r\nimport { Toast } from 'vant';\r\nimport http from '@/common/api/request.js'\r\nimport {mapState,mapGetters,mapMutations} from 'vuex'\r\nimport bus from '@/common/bus.js'\r\nimport qs from 'qs'\r\nexport default{\r\n    data () {\r\n        return {\r\n            radioPayment:'wx',\r\n            path:{},\r\n            item:[],\r\n            total:{\r\n                price:0,\r\n                num:0\r\n            }\r\n        }\r\n    },\r\n    computed:{\r\n        ...mapState({\r\n            order_id:state=>state.order.order_id,\r\n            selectList:state=>state.cart.selectList\r\n        }),\r\n        ...mapGetters(['defaultPath']),\r\n        \r\n    },\r\n    created() {\r\n        this.goodsList = JSON.parse( this.$route.query.goodsList );\r\n        this.selectAddress();\r\n    },\r\n    activated(){\r\n        bus.$on('selectPath', function(data){\r\n             \r\n            this.path = JSON.parse(data);\r\n             \r\n        }.bind(this));\r\n        //选中的商品id号\r\n        this.item = JSON.parse( this.$route.query.detail );\r\n        this.goodsList = JSON.parse( this.$route.query.goodsList );\r\n        this.selectOrder();\r\n    },\r\n    methods:{\r\n        ...mapMutations(['initData','initOrder']),\r\n        //查询地址\r\n        selectAddress(){\r\n            http.$axios({\r\n            \turl:'/api/selectAddress',\r\n                method:\"post\",\r\n                headers:{\r\n                    token:true\r\n                }\r\n            }).then(res=>{\r\n                this.initData( res.data );\r\n                //有默认收货地址\r\n                if( this.defaultPath.length ){\r\n                    this.path = this.defaultPath[0];\r\n                }else{\r\n                    this.path = res.data[0];\r\n                }\r\n            })\r\n        },\r\n        //查询订单\r\n        selectOrder(){\r\n            http.$axios({\r\n            \turl:'/api/selectOrder',\r\n                method:\"post\",\r\n                headers:{\r\n                    token:true\r\n                },\r\n                data:{\r\n                    orderId:this.order_id\r\n                }\r\n            }).then(res=>{\r\n                this.initOrder(res.data);\r\n                \r\n                this.total = {\r\n                    price : res.data[0].goods_price,\r\n                    num : res.data[0].goods_num\r\n                }\r\n            })\r\n        },\r\n        //选择收货地址\r\n        goPath(){\r\n            this.$router.push({\r\n                path:'/path',\r\n                query:{\r\n                    type:'select'\r\n                }\r\n            });\r\n        },\r\n        //提交订单\r\n        goPayment(){\r\n            //判断是否选择了收货地址\r\n            if( !this.path ) return Toast('请填写收货地址');\r\n            \r\n            //发送请求==》1.修改订单状态2.删除购物车的数据\r\n            http.$axios({\r\n            \turl:'/api/submitOrder',\r\n                method:\"post\",\r\n                headers:{\r\n                    token:true\r\n                },\r\n                data:{\r\n                    orderId:this.order_id,\r\n                    shopArr:this.selectList\r\n                }\r\n            }).then(res=>{\r\n                \r\n                let newArr = [];\r\n                this.goodsList.forEach(v=>{\r\n                    newArr.push( v.goods_name );\r\n                })\r\n                \r\n                //支付传递的参数\r\n                let dataOrder = {\r\n                    orderId:this.order_id,\r\n                    name:newArr.join(''),\r\n                    price:this.total.price\r\n                }\r\n                \r\n                if( res.success ){\r\n                    //去支付\r\n                    http.$axios({\r\n                    \turl:'/api/payment',\r\n                        method:\"post\",\r\n                        headers:{\r\n                            token:true,\r\n                            'Content-Type': 'application/x-www-form-urlencoded' \r\n                        },\r\n                        //qs是增加安全性的序列化\r\n                        data:qs.stringify(dataOrder)\r\n                    }).then(res=>{\r\n                        if( res.success ){\r\n                           //打开支付宝支付的页面\r\n                           window.location.href = res.paymentUrl;\r\n                        }\r\n                    })\r\n                    \r\n                }\r\n            })\r\n            return;\r\n        }\r\n    }\r\n}\r\n</script>\r\n\r\n<style lang='scss' scoped>\r\nheader {\r\n  display: flex;\r\n  justify-content: space-between;\r\n  align-items: center;\r\n  width: 100%;\r\n  height: 35px;\r\n  color: #fff;\r\n  background-color: #b0352f;\r\n  i {\r\n    padding: 0 10px;\r\n    font-size: 16px;\r\n  }\r\n  span {\r\n    font-weight: 300;\r\n    font-size: 15px;\r\n  }\r\n}\r\nsection {\r\n  background-color: #f7f7f7;\r\n  .path-title {\r\n    font-weight: 300;\r\n    padding: 0.4rem;\r\n    font-size: 0.48rem;\r\n  }\r\n  .path-content {\r\n    padding: 10px 15px;\r\n    font-size: 14px;\r\n    background-color: #ffffff;\r\n    span {\r\n      padding-right: 0.16rem;\r\n    }\r\n  }\r\n  .payment {\r\n    padding: 20px;\r\n    margin-top: 0.4rem;\r\n    font-size: 14px;\r\n    background-color: #ffffff;\r\n    .van-radio-group {\r\n      display: flex;\r\n      // padding: 0;\r\n      .van-radio {\r\n        padding-right: 0.266666rem;\r\n      }\r\n    }\r\n  }\r\n  .goods {\r\n    padding: 10px 10px;\r\n    margin-top: 10px;\r\n    font-size: 15px;\r\n    background-color: #ffffff;\r\n    ul {\r\n      width: 100%;\r\n      li {\r\n        padding: 15px 0;\r\n        display: flex;\r\n        width: 100%;\r\n        img {\r\n          width: 1.973333rem;\r\n          height: 1.973333rem;\r\n        }\r\n        .goods-content {\r\n          flex: 1;\r\n          display: flex;\r\n          flex-direction: column;\r\n          justify-content: space-between;\r\n          padding-left: 10px;\r\n          .goods-total {\r\n            display: flex;\r\n            justify-content: space-between;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\nfooter {\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  width: 100%;\r\n  height: 35px;\r\n  border-top: 1px solid #ccc;\r\n  .order-total {\r\n    font-size: 13px;\r\n    span {\r\n      padding: 0 6px;\r\n    }\r\n    b {\r\n      color: #b0352f;\r\n    }\r\n    em {\r\n      font-size: 15px;\r\n      color: #b0352f;\r\n    }\r\n  }\r\n  .order-topay {\r\n    width: 3.2rem;\r\n    line-height: 35px;\r\n    color: #fff;\r\n    font-size: 0.426666rem;\r\n    text-align: center;\r\n    background-color: #b0352f;\r\n  }\r\n}\r\n</style>\r\n"]},"metadata":{},"sourceType":"module"}